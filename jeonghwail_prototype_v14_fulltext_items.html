<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>정화일: 텍스트 어드벤처 프로토타입 v14 (A루트 방황 3연타)</title>
  <style>
    :root {
      --bg: #0e0f12;
      --panel: #161822;
      --panel2: #1f2230;
      --text: #e8e8ef;
      --muted: #b7b8c7;
      --accent: #8fd3ff;
      --danger: #ff7d7d;
      --ok: #8cffc1;
      --border: rgba(255,255,255,0.10);
      --shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(1200px 900px at 20% 0%, #151b28 0%, var(--bg) 55%);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
      line-height: 1.55;
    }
    a { color: var(--accent); }
    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 40px;
    }
    .topbar {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: rgba(14,15,18,0.65);
      border-bottom: 1px solid var(--border);
      padding: 12px 0;
      margin-bottom: 14px;
    }
    .topbar-inner {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      max-width: 980px;
      margin: 0 auto;
      padding: 0 14px;
    }
    .brand {
      display:flex;
      flex-direction: column;
      gap: 2px;
    }
    .brand .title {
      font-weight: 800;
      letter-spacing: 0.2px;
      font-size: 15px;
    }
    .brand .subtitle {
      color: var(--muted);
      font-size: 12px;
    }
    .stats {
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }
    .pill {
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap: 8px;
      align-items: center;
      user-select: none;
    }
    .pill b { color: var(--text); font-weight: 800; }
    .pill .bad { color: var(--danger); font-weight: 800; }
    .pill .good { color: var(--ok); font-weight: 800; }
    .actions {
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }
    button {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      padding: 9px 12px;
      cursor: pointer;
      transition: transform 0.08s ease, background 0.15s ease, border-color 0.15s ease;
      font-weight: 700;
      font-size: 13px;
    }
    button:hover { background: rgba(255,255,255,0.09); border-color: rgba(255,255,255,0.16); }
    button:active { transform: translateY(1px); }
    button.primary {
      background: rgba(143, 211, 255, 0.16);
      border-color: rgba(143, 211, 255, 0.35);
    }
    button.danger {
      background: rgba(255, 125, 125, 0.14);
      border-color: rgba(255, 125, 125, 0.34);
    }
    button.ghost {
      background: transparent;
    }

    .grid {
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 900px) {
      .grid { grid-template-columns: 1.2fr 0.8fr; align-items: start; }
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.035));
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card .head {
      padding: 14px 16px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
    }
    .card .head .h {
      font-weight: 900;
      font-size: 14px;
      letter-spacing: 0.2px;
    }
    .card .head .h small { font-weight: 700; color: var(--muted); }
    .card .body {
      padding: 14px 16px 16px;
    }

    .scene {
      white-space: pre-wrap;
      font-size: 14px;
    }
    .choices {
      margin-top: 14px;
      display: grid;
      gap: 10px;
    }
    .choice-btn {
      text-align: left;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      line-height: 1.4;
    }
    .choice-btn:hover { background: rgba(255,255,255,0.09); }
    .choice-btn .meta { display:block; margin-top: 6px; color: var(--muted); font-size: 12px; font-weight: 600; }
    .hr {
      height: 1px;
      background: var(--border);
      margin: 12px 0;
    }

    .tabs {
      display:flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .tab {
      border-radius: 999px;
      padding: 7px 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      cursor: pointer;
      user-select:none;
    }
    .tab.active {
      background: rgba(143, 211, 255, 0.16);
      border-color: rgba(143, 211, 255, 0.35);
      color: var(--text);
    }

    .inv-list { display: grid; gap: 10px; }
    .inv-item {
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      cursor: pointer;
    }
    .inv-item:hover { background: rgba(255,255,255,0.08); }
    .inv-item .left { display:flex; flex-direction: column; gap: 2px; }
    .inv-item .code { font-weight: 900; letter-spacing: 0.2px; font-size: 12px; color: var(--accent); }
    .inv-item .name { font-weight: 900; font-size: 13px; }
    .inv-item .type { font-size: 12px; color: var(--muted); font-weight: 700; }
    .inv-empty { color: var(--muted); font-size: 13px; }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 50;
    }
    .modal.open { display:flex; }
    .modal .box {
      width: min(720px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.05));
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .modal .box .mh {
      padding: 14px 16px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }
    .modal .box .mh .t {
      font-weight: 900;
      font-size: 14px;
    }
    .modal .box .mb {
      padding: 14px 16px 16px;
      color: var(--text);
      white-space: pre-wrap;
      font-size: 13.5px;
    }
    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.75);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      display:none;
      z-index: 60;
      max-width: min(760px, 92vw);
      box-shadow: var(--shadow);
      font-size: 13px;
    }
    .toast.show { display:block; }
    .muted { color: var(--muted); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="title">정화일: Dies Lustrationis <span class="muted">· 프로토타입 v14</span></div>
        <div class="subtitle">스토리 통합본 + A루트 방황 3연타(고정) · 식사/허기 시스템 제거(스토리 텍스트 전용)</div>
      </div>
      <div class="stats">
        <div class="pill" title="현재 날짜(일차)">
          Day <b id="statDay">1</b>
        </div>
        <div class="pill" title="다음 정화일까지 남은 일수">
          정화까지 <b id="statD">D-3</b>
        </div>
        <div class="pill" title="체력(0이면 배드엔딩)">
          체력 <b id="statHP">3</b>/<span id="statHPMax">5</span>
        </div>
        <div class="pill" title="기능성 MAM 보유 여부">
          MAM <b id="statMAM" class="bad">없음</b>
        </div>
      </div>
      <div class="actions">
        <button id="btnRest" class="primary" title="하루를 보냅니다. (체력 +1, 상한 5)">휴식</button>
        <button id="btnSave" title="현재 진행상황 저장(브라우저)">저장</button>
        <button id="btnLoad" title="저장된 진행상황 불러오기(브라우저)">불러오기</button>
        <button id="btnNew" class="danger" title="처음부터 다시 시작(저장도 초기화)">새로 시작</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <div class="head">
          <div class="h">본문 <small id="sceneLabel">· Prologue</small></div>
          <div class="muted mono" id="sceneId">scene: prologue</div>
        </div>
        <div class="body">
          <div id="sceneText" class="scene"></div>
          <div class="choices" id="choices"></div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <div class="h">패널</div>
          <div class="muted" id="panelHint">인벤토리/로그</div>
        </div>
        <div class="body">
          <div class="tabs">
            <div class="tab active" data-tab="inventory">인벤토리</div>
            <div class="tab" data-tab="log">로그</div>
            <div class="tab" data-tab="help">도움말</div>
          </div>

          <div id="tab-inventory">
            <div class="muted" style="margin-bottom:10px;">
              아이템은 <b class="mono">코드</b>로 관리됩니다. 클릭하면 플레이버 텍스트가 뜹니다.
            </div>
            <div id="invList" class="inv-list"></div>
            <div id="invEmpty" class="inv-empty" style="display:none;">아직 획득한 아이템이 없습니다.</div>
          </div>

          <div id="tab-log" style="display:none;">
            <div class="muted" style="margin-bottom:10px;">최근 변화(체력/아이템/플래그)를 기록합니다.</div>
            <div id="logBox" class="scene muted"></div>
          </div>

          <div id="tab-help" style="display:none;">
            <div class="scene muted">
- 이 파일은 단독 실행(PC/모바일 브라우저)되는 HTML 프로토타입입니다.
- “휴식”은 하루를 넘기고 체력을 1 회복합니다(상한 5).
- D-0(정화일)이 되면, 기능성 MAM이 없을 경우 ‘질식’ 배드엔딩이 발생합니다.
- 저장/불러오기는 브라우저 localStorage를 사용합니다.
            </div>
            <div class="hr"></div>
            <div class="scene muted">
GitHub Pages 업로드 팁
- 파일명을 .html 그대로 저장 → 레포지토리(루트 또는 docs/)에 커밋
- Pages 설정에서 브랜치/폴더 확인
- 경로에 한글/공백이 섞여도 되지만, 간단한 영문 파일명이 안정적입니다.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="box">
      <div class="mh">
        <div class="t" id="modalTitle">아이템</div>
        <button class="ghost" id="modalClose">닫기</button>
      </div>
      <div class="mb" id="modalBody"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  const STORAGE_KEY = "jeonghwail_save_v14";

  // -----------------------------
  // Items (code-managed)
  // -----------------------------
  const ITEM_DB = {
  "item00": {
    "code": "itemno.00",
    "name": "수첩 (루스트라 배포용)",
    "type": "KEY",
    "desc": "수첩 첫 페이지에는 정갈하게 인쇄된 활자가 적혀 있다.\n“망각은 순수로의 첫 걸음이다.”\n(루스트라 기억구제국 배포용)\n\n누군가의 친절이거나, 누군가의 올가미다."
  },
  "item01": {
    "code": "itemno.01",
    "name": "루스트라 교단의 기억보존장치",
    "type": "KEY",
    "desc": "임시 기억보존장치(MAM).\n언어·생활규칙·생존 필수 기능을 ‘안정화’한다.\n\n당신의 이름이, 장치와 함께 묶여버린 느낌이 든다."
  },
  "item02": {
    "code": "itemno.02",
    "name": "수첩 (무늬 없는 수첩)",
    "type": "EVENT",
    "desc": "말라빠지고 아무런 무늬 없는 수첩.\n듬성듬성 찢긴 페이지와, 표지 안쪽의 지워진 이름.\n\n여기선 기억이 사치품이라 했다."
  },
  "item03": {
    "code": "itemno.03",
    "name": "기억보존장치 MAM (기초형)",
    "type": "KEY",
    "desc": "Memory Authentication Module.\n사람이 사는데 있어 가장 필요한 기초적인 것을 ‘기억하게 지켜주는’ 장치.\n\n숨쉬는 법과 눈 깜빡이는 법까지 포함된다."
  },
  "item04": {
    "code": "itemno.04",
    "name": "봉인된 편지",
    "type": "EVENT",
    "desc": "도착할 때까지 열어서는 안 된다.\n그저 전해주고, ‘대답’만 듣고 돌아오라 했다.\n\n편지지 사이로 잿빛 비냄새가 밴 듯하다."
  }
};

  // -----------------------------
  // State
  // -----------------------------
  const DEFAULT_STATE = () => ({
    version: 13,
    sceneId: "prologue",
    day: 1,
    daysUntilPurification: 3, // D-3 시작
    hp: 3,
    hpMax: 5,
    playerName: "",
    flags: {
      hasFunctionalMAM: false,
      knowsPurificationCycle: true,
      metPriest: false
    },
    inventory: [], // array of item codes
    log: []
  });

  let state = DEFAULT_STATE();

  // -----------------------------
  // Utility
  // -----------------------------
  const el = (id) => document.getElementById(id);

  function toast(msg){
    const t = el("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 2400);
  }

  function addLog(msg){
    const stamp = `Day ${state.day} · ${msg}`;
    state.log.unshift(stamp);
    if (state.log.length > 50) state.log.pop();
    renderLog();
  }

  function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

  function hasItem(code){ return state.inventory.includes(code); }

  function addItem(code){
    if (!ITEM_DB[code]) return;
    if (hasItem(code)) return;
    state.inventory.push(code);
    addLog(`아이템 획득: ${ITEM_DB[code].name} (${code})`);
    renderInventory();
    renderStats();
  }

  function setFunctionalMAM(on){
    state.flags.hasFunctionalMAM = !!on;
    renderStats();
  }

  function formatD(){
    const d = Math.max(0, state.daysUntilPurification);
    return `D-${d}`;
  }

  function substitute(text){
    const name = state.playerName ? state.playerName : "(playername)";
    return text.replaceAll("(playername)", name).replaceAll("playername", name);
  }

  // -----------------------------
  // Scenes
  // -----------------------------
  const SCENES = {
prologue: {
  label: "정화일 — 프롤로그",
  text: `장대와도 같은 비가 검은 하늘 아래로 쏟아져 내린다.
땅으로 부딪혀 튕겨나간 빗방울은 마구잡으로 흩날려 세상을 물들인다.
잿빛의 하늘, 끊기지 않는 총성과도 같은 빗소리가 당신의 고막을 끊임없이 두들긴다.

이 비는 기억을 지운다.

당신은 이 폭우 속에서 기억이 지워져내렸다.

작은 처마 한 켠의 자비조차 없는 이 도시속에서, 당신은 목에 걸린 기억보존 장치가 기긱거리는 소음을 내며 작동하는 것을 깨닫는다. 깨져있는 모습을 보아하니, 작동하는 것 만으로도 감사할 지경이다.

흘러내리는 기억의 홍수속에서 몇 가지 삶을 살아갈 수 있는 정보들이 단단히 서 있는 기둥처럼 당신의 기억 한 켠에 자리잡는다.

언어. 사회규범. 숨 쉬는 법. 걷는 법. 인사하는 법.

뭔가 더 기억해야할 것이 있는 듯 하지만, 깨어진 기둥을 메울 재료는 없다.

당신은 우선 자신의 상태를 확인한다.

이름. 기억에 없음.
나이. 기억에 없음.
거주지. 기억에 없음.
직장. 기억에 없음.
가족. 기억에 없음.

당신은 아무것도 기억하지 못하는 이 상황과 더불어, 도움을 청할 행인조차 없는 거리에 야속함마저 느낀다.

저 멀리서 경비 드론이 당신을 발견하고 다가온다.
렌즈가 물기를 털어내듯 깜빡인다.

드론 : 현재 정화작업으로, 인공강우가 내리고 있습니다. 시민여러분께서는 즉시 집으로 귀가하시기 바랍니다. 불응할 시, 귀하의 기억 보존 장치를 제시하여 신분을 증명해주시기 바랍니다.`,
  choices: [{"text": "기억 보존장치를 제시한다", "next": "a_show_mam"}, {"text": "도망친다", "next": "a_run"}]
},

a_show_mam: {
  label: "A루트 — 재심사장으로",
  text: `당신은 드론의 스캐너 앞에 착용하고 있던, 기억보존장치(Memeory Authentication Memory MAM)를 제시한다.
당신의 눈앞으로 강렬한 스캔 레이저가 스쳐지나간다. 시력이 손상될 것 같은 빛에 당신은 눈을 찌푸린다. 부디 드론의 카메라가 당신의 표정을 읽을 수 없기를.

드론 : 스캔이 완료되었으나, 오류로 인하여 등록정보를 확인할 수 없었습니다. 소지하고 계신 기억보존장치는 본인 소유의 물건이 맞으십니까?

아뿔싸.
당신은 허탈한 표정으로 빗물에 젖은 얼굴을 빗물에 흠뻑 젖은 손으로 문지른다. 
철벅. 철벅.

고개를 끄덕이며 당신은 그렇다고 드론에게 대답한다.

드론 : 기억보존장치의 손상으로 등록된 주민이 확인되지 않을 경우, 주민 재심사장으로 이동하여 재등록하실 것을 권장드립니다. 동의하십니까?

짓궂은 농담이다. 그 것 외에 선택지는 존재하지 않을것임을 당신은 직감적으로 깨닫는다.

당신은 쏟아지는 폭우를 한 뼘도 가리지 못한 채로 드론의 안내를 따라 주민등록 재심사장에 도착했다.`,
  choices: [{"text": "재심사장으로 이동한다", "next": "a_office"}]
},

a_run: {
  label: "A루트 — 도주",
  text: `당신은 드론의 요구에 응하는 것 보다도 본능적인 공포에 몸을 맡겨, 즉시 뒤로 돌아 달음박질했다.

쏟아져내리는 빗소리를 뚫고 드론의 섬짓한 경고음이 날아든다.

드론 : 검문에 응하지 않을 시, 제압탄 사격이 허용됩니다. 5초 내로 돌아오시기를 권장드립니다. 다시 말씀드립니다. 3초내로 돌아오지 않을 시 시민의 안전을 위해 제압탄 사격이 허용됩니다.

무작정 앞으로, 앞으로.
폐부가 찢겨나가는 고통 속에서도 당신은 앞을 향해 달린다.

드론 : 2… 1.. 제압탄을 사용합니다. 

텅

둔탁한 소리와 함께 당신의 시선은 도시 끝에서 지면을 향한다. 갑작스런 방향전환에 어지럼증을 느끼고 난 뒤, 찰나의 순간 허리에서 강렬한 통증이 느껴진다. 망치로 강타를 당한 듯한 고통. 비명조차 나오지 않았다.

뒤이어 위잉 하는 소리와 함께 드론이 가까워지는 소리.
도저히 견디기가 힘들다. 그냥 기절해버리고 싶다는 욕망이 목구멍까지 차오른다. 당신의 볼이 맞닿아 있는 딱딱한 지면에 물이 고여갈수록, 스스로의 기억이 흐릿해져가는 기분이 든다. 당신은 무언가 떠올리기 위해 애쓰지만, 행위의 목적조차 흐리다. 도망쳐야하는 이유는..?`,
  choices: [{"text": "정신을 잃는다", "next": "a_dragged", "effects": [{"op": "hp", "delta": -1}]}, {"text": "고통을 짓이기고 도망친다", "next": "b_escape"}]
},

a_dragged: {
  label: "B루트 진입 — 끌려간다",
  text: `당신의 하루는 시작한 지 얼마 되지 않았지만, 아니 어쩌면 당신의 인생을 시작한 지 얼마 되지 않았겠지만. 이 정도면 충분히 고단했다. 비에 젖은 채로 커다란 드론에게 쫓기는것도 모자라서 비 살상 탄환이지만 총까지 맞다니.

이 곳에서 잠시 눈을 감고 무슨 일이 벌어질지 잠자코 지켜볼 충분한 사유가 될것이라고 스스로 생각한다. 

실존할지는 모르는 ‘기절할 권리’를 마음속으로 주장하며 당신은 정신을 잃는다.

땅바닥이 차갑고, 당신을 이끄는 드론의 팔은 더 차가웠다.

기력감소 (체력-1)`,
  choices: [{"text": "…", "next": "b_resistance_1"}]
},

a_office: {
  label: "A루트 — 주민등록 재심사장",
  text: `드론을 따라 도착한 곳은 주민등록 재심사장이었다.
폭우 속을 쉬지 않고 걸은 탓에, 온몸은 물먹은 스펀지처럼 푹 젖어 있었지만, 입 안쪽은 까끌까끌했다. 당신은 갈증을 느끼며 이 어이없는 상황에 기이함을 체험했다.

비교적 밝고 깨끗한, 대리석으로 만들어진 바닥에 홀로 서 있는 자신의 몰골을 깨닫고는 조금 비참한 기분을 느꼈다.

어이없게도 드론은 당신에게 사람이 인사하듯 고개를 꾸벅 숙이고는 다시 비가 내리는 바깥으로 이동했다. 당신도 뒤늦게나마 어색하게 고개를 숙였다.

이곳을 찾는 사람은 많지 않았다.
아마도, 당신처럼 어떤 이유로든 간에 기억보존장치가 파손되었거나, 분실된 사람들일 것이다.

카운터에 서 있는 직원이 기묘하게 밝은 얼굴로 당신을 맞이하며 인사를 건넨다.
당신은 왠지 잘못한 어린아이처럼 쭈뼛거린다.

직원 : 안녕하세요, 주민등록 재심사 대상자시군요? 가지고 계신 기억보존장치를 보여주실 수 있으실까요?

직원은 상냥하게 당신의 신분을 확인하려 한다.
당신은 파손된 안쪽으로 물이 차서 찰랑거리는 소리가 나는 기억보존장치를 들어 지저분한 손으로 직원에게 건넨다.
직원은 꺼려하는 기색 없이 당신의 장치를 들어 자세히 살펴보고는 안내한다.

직원 : 아.. 이런, 기억보존장치가 파손되셨네요.. 괜찮습니다! 파손이나 분실로 찾아오시는 분들이 이렇게 종종 있으시거든요! 수첩 같은 개인 기록물을 주셔도 확인할 수 있으니 한 번 찾아보시겠어요?

그제서야 당신은 개인 소지품을 통해 자신을 추측할 수 있음을 깨닫고는 주섬주섬 주머니를 뒤지기 시작한다.
물에 젖어 엉망진창이 된 수첩 한 권이 안주머니에서 나온다.

이 수첩은 열어보지 않는 편이 좋을 듯하다.

직원 : 아.. 하하, 이거 참 곤란하게 되었네요. 괜찮습니다. 저기 옆쪽으로 가시면 [루스트라 교단 기억 구제국] 창구가 있거든요. 관청과 협의해서 무료로 임시 기억보존장치를 대여하거나 "무상"으로 제공해드리고 있으니, 우선 임시 신분을 신고하신 후에 본래 신분으로 이전하시면 되니까요. 아무리 저렴한 기억보존장치라고 해도, 이렇게 무상으로 제공하시다니, 정말 상냥한 분들이라니까요.

당신은 직원의 안내로 옆 창구의 하얀 사제복을 입고 있는 교단의 사제에게 다가간다. 곧이어 직원은 당신이 서 있던 자리로 와서 바닥에 괸 빗물을 대걸레로 훔치기 시작한다. 고요하고, 고요하다.

교단의 사제는 조용히 미소를 지으며 옆자리에서 서류 한 장과 당신이 지니고 있던 것의 새 제품인 듯한 기억보존장치를 꺼내어 테이블 앞에 내민다. 실로 온화한 미소이다. 종교인은 모두 이런 느낌인가? 라는 의문을 가지며 종이에 손을 내밀던 당신에게 사제는 손바닥을 내민다.

사제 : 종이를 만지시기 전에 손을 닦으시지 않는다면, 이 서류를 두 번 쓰셔야 할 겁니다, 형제님.

사제는 가벼운 농을 던지며 테이블 아래의 서랍에서 수건을 꺼내어 건넨다.
당신이 손에 쥔 수건에서는 희미한 온기가 느껴진다. 당신은 깊은 감사를 표하며 우선 손과 얼굴, 머리를 수건으로 닦아낸다.

사제 : 종종 이런 분들이 찾아오시거든요. 자, 별거 아닌 서류니까 보고 밑에 서명만 해주시면 됩니다. 이름이 필요하거든요.

당신은 스스로의 이름을 기억하지는 못하지만, 그렇다고 그것이 서명하지 못할 일은 아님은 알고 있다.

사제 : 본명을 기억하지 못하신다면, 떠오르는 이름을 적으셔도 괜찮습니다.

잠시 사제는 뜸을 들이고는 알 수 없는 미소를 지으며 당신의 시선을 끌어당긴다. 아주 잠깐의 적막 속에서 당신은 옷에서 떨어지는 빗물의 소리를 들었다.

사제 : 그 "이름"이 당신을 의미하도록 만들면 되니까요.`,
  choices: [{"text": "건네어진 서류를 읽는다", "next": "a_sign"}]
},

a_sign: {
  label: "A루트 — 동의서",
  text: `MAM 복지 수혜 및 기억 구제 지원 동의서 (요약본)

문서번호: LV-SS--
발급기관: 루스트라 신앙 산하 기억구제국 / 도시행정청 협력기관

본인은 아래 사항을 충분히 읽고 이해하였으며, 정화 복지의 지속과 시민 안전을 위하여 동의합니다.

<핵심 지원 안내>
▶ 기억보존장치 Memory Authentication Module(이하 MAM)의 기초 기능 무상 지원(임시)
▶ 정화일 규범 준수 의무
▶ 월 소득 10% 이상 구제 분담금 납부 의무

지원 내용

본인은 기억 보존 장치(MAM) 기초 기능에 대한 지원(지급/대여/유지)을 무상으로 받을 수 있습니다. (단, 제3조의 '구제 분담금' 의무는 별도의 항목입니다.)

본 지원은 세정 강우로 인한 일시적 기억 손실에 대비하여 언어·생활규칙·생존 필수 기능을 안정화하는 것을 목적으로 합니다.

본 지원의 세부 범위 및 방식은 정화일 운영 지침에 따라 변경될 수 있습니다.

준수 의무

본인은 정화일 기간 중 관계 기관의 안내(귀가 권고, 검문, 재심사 절차 등)에 협조합니다.

본인은 정화일 규범 및 공공 안전 지침을 준수합니다.

정화 복지 기여(구제 분담금)

본인은 정화 복지(기억 구제 사업)의 지속을 위하여 월 소득의 10% 이상을 *정화 복지 기여금(구제 분담금)*으로 봉납합니다.

본 기여금은 구휼·봉사·기부 및 기억 구제 사업에 우선 사용되며, 사업 지속을 위한 교단 운영에 필요한 "최소 비용"이 포함될 수 있습니다.

기여금 미이행 또는 반복 지연 시, 본 지원은 일시 정지될 수 있으며 재심사 절차가 개시될 수 있습니다.

본인은 본 동의가 철회될 경우, 지원 제공이 중단될 수 있음을 이해합니다.

서명

본인은 위 내용을 읽고 이해하였으며, 이에 동의합니다.

서명: ___________________
등록번호(확인 불가 시 공란): ___________________

서류 맨 하단에는 아주 작은 글씨가 적혀 있었다.
눈을 찌푸리고 얼굴을 가까이 하여 읽어보니 다음과 같은 내용이 적혀 있다.

본 동의서는 정화 복지 지원의 요건을 정하는 문서이며, 관계 기관은 정화일 집행을 위해 추가 확인을 요청할 수 있습니다.
본 문서에 따른 지원은 정화일 규범 위반, 불응, 허위 기재, 비인가 장치 사용 등 사유 발생 시 제한될 수 있습니다.

이 복잡한 내용이 무엇을 의미하는지는 잘 모르겠지만, 꽤나 불편한 느낌이 든다.

당신은 펜을 쥔다.
펜에서 끈적한 잉크가 새어 나와 종이를 물들인다.
무슨 의미가 있는 이름인지는 모르겠으나, 마치 오래전부터 알고 있었던 기분이 든다.

공간 속에서 펜이 종이를 긁는 소리와 빗방울이 옷자락에서 바닥으로 떨어지는 소리 외에는 모두가 숨을 죽이고 있다. 마치 세계가 당신의 행동 한 프레임 한 프레임을 지켜보는 듯한 기분이다.

당신은 침을 꼴깍 삼키고 싶었으나, 이 침묵을 깰 자신이 없어 그저 펜을 움직일 수밖에 없었다.`,
  choices: [{"text": "서명한다", "next": "a_claim", "effects": [{"op": "promptName"}]}]
},

a_claim: {
  label: "A루트 — ‘무상’ 지원",
  text: `사제 : 임시 등록 서류 작성 완료 되셨구요. (playername)님, 여기 새 기억보존장치 받으시면 됩니다. 그리고, 이건 도움이 될까 해서 드리는 거예요. 가지고 계시던 건 모두 젖어버리셨으니까 말이죠. 그리고...

-item "수첩" 획득
-item “루스트라 교단의 기억보존장치“ 획득

수첩 첫 페이지에는 정갈하게 인쇄된 활자가 적혀 있다.
"망각은 순수로의 첫 걸음이다."
(루스트라 기억구제국 배포용)

사제 : 루스트라 교단에 입교하신 것을 환영해요, 형제님.
사제는 오른손바닥으로 작은 글씨로 적힌 경고 문구를 가리는 듯한 자세로 서류를 거두어간다.

오싹한 기분이 등줄기를 훑는다.
이름과 기억보존장치라는 작은 기계장치를 대가로, 어마어마한 실수를 저지른 것 같은 기분을 떨칠 수가 없다.

하지만 당신은 그 실수가 어떤 종류인지조차 모른다.`,
  onEnter: [{"op": "addItem", "code": "item00"}, {"op": "addItem", "code": "item01"}, {"op": "flag", "key": "hasFunctionalMAM", "val": true}],
  choices: [{"text": "밖으로 나온다", "next": "a_wander1"}]
},

b_escape: {
  label: "B루트 — 낙하",
  text: `이유는 몰라도 당신은 지친 몸을 억지로 끌어당겨 일어난다. 
포식자에게 쫓기는 피식자는 도망치는 이유가 없다.
아직 다리를 다치지 않았으므로 다행히 일어날 수 있다.

드론 : 대상자의 전도를 확인. 다시 한 번 경고합니다. 검문에 불응할 시, 제압탄이 다시 발포될 수 있음을 안내드립니다. 

드론이 점점 더 가까이 다가온다. 당신은 드론을 향해 천천히 몸을 돌린다. 
아직 조금 더.. 조금 더.. 가까이. 당신의 팔이 닿을 때 까지. 찰나의 순간이지만 조금이나마 등의 통증도 완화시킨다.

드론 : 양손을 들고 공격의사가 없음을 보여주십시오. 선량한 시민으로서의 규범을 자각하시기 바랍니다. 기억저장장치가 있다면 한쪽 손에 들어주시기 바랍니다.

당신은 드론이 지근거리에 다가오는 순간 거센 발차기로 드론을 넘어뜨렸다. 

그리고 다시 시작된 도주. 다행히 시야에는 도시의 끝이 보인다. 콘크리트로 만들어진 회색 관문 뒤로 희망이 보인다. 그리고 그 순간

탕! 

드론 : 제압탄과 두 번의 경고에도 불구하고, 시민으로서 의무를 이행하지 않았습니다. 
실탄의 사용이 승인되었습니다.

드론의 초탄은 균형을 잃은 탓인지 다행히도 어깨 너머로 스쳐지나갔다. 당신은 등 뒤가 쭈뼛 서는 감각을 느낀다. 죽음의 공포가 고인 빗물로부터 발목을 타고 등위로 기어올라온다.

저 철창만 넘으면 살 수 있다.
저 철창만 넘으면.
살아있기만 하다면 기회는 온다. 기억을 되찾는 것도, 삶의 의미를 되새기는 것도. 당신은 각오를 굳히고 낮은 철창 문을 향해 몸을 날린다.

동시에 드론의 총구에서도 탄환이 달음박질한다.

탕!

철창 너머는 가파른 경사로 이루어진 동굴이었다. 당신은 구르고, 구르고 또다시 굴러 떨어지고 있다. 돌밭에 구르는 고통을 느끼는 도중, 허벅지에 불이 붙은 것과 같은 통증을 느낀다. 총상이다. 

하지만 당신은 살아남았다.
구르고 굴러서 다다른 바닥은 어디일까. 당신은 잠시 눈을 감고 생각을 멈추기로 했다.

-부상입음(체력 -2)`,
  onEnter: [{"op": "hp", "delta": -2}],
  choices: [{"text": "…", "next": "b_resistance_1"}]
},

b_resistance_1: {
  label: "B루트 — 카타콤",
  text: `눈을 감으면 어둠이 내려앉는다.
당신은 의식을 잃지 못한 채 어둠 속으로 가라앉는 기분을 느낀다.

당신의 머리속에 어떤 종교의 한 구절이 아스라히 펼쳐진다.

"신께서 어둠 중에 이르시되 빛이 있으라 하셨고, 이에 빛이 있었다."

고통에 몸부림치면서도 당신은 빛을 갈구한다.
무거운 눈꺼풀을 들어올렸음에도 어둠이 가득한 곳.

허나, 빛이 있으라는 구절과 함께 저 멀리서 아주 희미한 빛이 당신에게 다가오기 시작했다.

??? : 어이, 무슨소리가 났나 했더니 정말 저기 사람이 굴러들어왔잖아?

??? : 어이쿠, 꼴이 엉망이로구만. 빌어먹을 레테가 흘러내리는 날에는 이렇게 같이 흘러들어오는 인간들도 종종 있단 말이지. 

두 사람의 목소리와 함께.

예의를 아는 사람이라면 응당 일어나 악수나 목례, 혹은 배례를 하겠지만, 당신은 예의를 차릴 수 있는 상태가 아니다. 
그나마 인사 대신 건넬 수 있었던 것은 나지막한 신음소리 뿐이었다.

??? : 밖에서 비도 맞고, 기억도 잃고, 온갖 고초를 헤치고 왔다는 늠름한 표정이로구만. 기개가 있어.

??? : 이것 보라고 보리스, 이 녀석 허벅지에 총상까지 있는데? 간덩이가 보통 부은게 아닌걸?

두 남성은 당신을 찬찬히 둘러보며 감상을 말한다.
조금만 더 몸 상태가 멀쩡했다면 당신은 그렇게 구경만 하고 있을거라면 꺼져줬으면 하는 말을 뱉었을지도 모른다고 생각한다.

보리스 : 뭐? 총상? 어디 어디. 이것 참... 이봐 쉬나벨, 총상 환자면 어서 옮겨야지! 그렇게 구경만 하고 있을건가?

쉬나벨 : 나 참, 오랜만에 밖에서 흘러온 사람이라서 내가 의사인줄도 깜빡하고 있었네 그려. 자, 어서 옮기자고. 이봐, 좀 아프더라도 참게. 뭣하면 정신을 잠깐 정도는 잃어도 괜찮네. 어차피 총알 뺄 때 아파서 일어나게 될테니까 말이야.

당신은 보리스와 쉬나벨이라고 서로를 부르는 남자 둘에게 양 겨드랑이와 발목이 붙잡혔다. 
쾌적한 승차감의 들 것이라고는 도저히 말 할 수 없었지만, 한 결 마음이 편안해진 덕분인지 다시금 정신을 잃었다.`,
  choices: [{"text": "…", "next": "b_awake"}]
},

b_awake: {
  label: "B루트 — 눈을 뜬다",
  text: `정신을 차리고 눈을 떠 보니 당신에게 보이는 것은 낯선 천장이었다. 기억을 모조리 잃은 당신에게 익숙한 것이 있을리가 만무하지만, 어쨌든 잿빛 구름으로 가득 차있고, 기억을 지우는 비가 끝도 없이 퍼붓는 천장보다는 훨씬 나은 편이었다.

당신이 누워있던 침상 옆에는 보리스와 쉬나벨이라고 하던 사람들이 있었다.

예의를 좀 차리자면, 두 남자가 당신을 옮겨와서 치료한 곳은 퍽 아늑한 느낌이 들었다. 건조하고 흙냄새가 나고, 조금 비좁지만, 당신은 그 공간을 꽤 마음에 든다고 생각했다.
특히, 테이블 위에 있는 오래된 듯한 가스램프에서 불꽃이 일렁일 때 마다 돌로 깎여나가 울퉁불퉁한 벽들의 그림자들이 춤을 추는 느낌이 더욱 좋았다.

쉬나벨이라고 하는 남자가 먼저 당신이 정신이 든 것을 깨달았다.

쉬나벨 : 이보게 보리스, 마침내 그가 눈을 떴네! 그나저나 자네 정말 대단하더구만! 상처에서 납탄을 뽑아내고 소독하고 꿰메고 약을 바르고 붕대를 감는 동안 내내 코도 안골고 기절해있더라고. 마취도 안했는데 말이야. 

(응급처치 - 체력+1)

보리스 : 자네. 운이 좋은 편이군. 이친구, 말은 이렇게 사짜같이 하는데다가 왠 까마귀부리 가면같은걸 쓰고 다니지만, 이 카타콤 내부에선 이정도 의료실력을 갖춘 녀석이 없거든. 우리가 자넬 발견한 시기가 빨랐던것도 한 몫 했겠지.

당신은 예의를 갖춰 감사를 표하려고 자리에서 일어나려고 시도했지만, 전신의 격통이 몰려와 도로 누울 수 밖에 없었다.

쉬나벨 : 얼마나 급박하게 쫓겼는지는 모르겠지만, 전신이 타박상과 열상이 있어. 허리쪽엔 강한 찰과상에 허벅지는 총상까지. 좀 쉬어둘 필요가 있네. 물론 회복력이 어마어마해서 한숨 더 푹 자고 나면 아마 움직일 정도는 될거야! 숨쉬는 방법은 잊지 않아서 정말 다행이군, 친구!

보리스 : 뭐, 이곳에 사연없이 오는 녀석은 없네만.. 자네는.. 다른 사람들보다 더 정보가 없구만. 미안하게 되었지만 자네 소지품을 좀 뒤저보았네. 이곳이 어디인지 아직 말해줄 수는 없지만, 외지사람을 데려올 때는 늘 경계가 필요한 법 아니겠나?`,
  onEnter: [{"op": "hp", "delta": 1}],
  choices: [{"text": "소지품을 확인한다", "next": "b_boris_items"}]
},

b_boris_items: {
  label: "B루트 — 수첩",
  text: `보리스는 협탁에서 당신의 소지품.. 이었던것 처럼 보이는 무언가를 꺼내 당신 앞에 내놓았다.

너덜너덜하고 물에 젖어 쓰레기 외의 용도로는 보이지 않는 수첩과, 목에 걸고 있던 파손된 기억보존장치. 이제는 반으로 박살난 데다가, 나머지 반쪽은 지상에 두고온 듯 하다.

보리스 : 보다시피, 자네 소지품은 이게 전부던데.. 어디 원한이라도 산게 아닌가 싶을 정도일세. 우선, 이거라도 받게. 아무리 그래도 이정도는 가지고 있는게 좋을걸세. 새 수첩은 아니지만…

보리스에게 말라빠지고 아무런 무늬 없는 수첩을 건네받았다. 듬성듬성 페이지가 찢겨있고, 표지 안쪽에는 사람의 이름이 적혀있었으나 펜으로 지워진 흔적이 남아있다. 당신과 어딘가 닮은 수첩이다.

보리스 : 여기선, 이 도시에선 기억은 사치품에 가깝네. 그래서 많은 사람들은 이런 수첩에 자신을 기록하지. 물론 카타콤 안에 박혀있는다면, 기억을 잃을 일은 별로 없지만 말이야. 
그 빌어먹을 비 때문에 우리는 여기 숨어살고 있지.. 

당신은 보리스의 눈동자 속에서 끓는듯한 분노를 느낀다. 당장이라도 탁자를 내려치며 화를 낼 기세이다.

다행히 쉬나벨이 끼어들어 당신에게 말했다.

쉬나벨 : 자, 자. 당장 저 비를 말라비틀어지게 할 방법은 없지않나, 보리스. 우리들이 뜻을 모으고 시간을 들인다면, 빠른 시일 내로 저런 빗물은 변기 물로나 쓰게 될거라고. 하하! 그나저나 친구, 혹시 자네 이름은.. 기억하나?

당신은 고개를 저었다. 스스로가 누군지에 대해서 고뇌한들, 씻겨내려간 기억은 돌아오지 않는다. 변기물이 역류하지 않는 한. 물론 당신의 머리가 변기라는 뜻은 아니다.

쉬나벨 : 그렇다면, 임시로라도 자네 이름을 가지고 있는게 좋을걸세. 이동네는 그게 중요하거든. 자네가 기억하지 못한다 한들, 어딘가에 적어놓는다면 신분으로서 기능하기 때문이지. 그게 있고 없고가 꽤 중요하단 말일세.
자, 그럼 여기에 한번 멋들어보게 적어보겠나?`,
  onEnter: [{"op": "addItem", "code": "item02"}],
  choices: [{"text": "이름을 적는다", "next": "b_after_name", "effects": [{"op": "promptName"}]}, {"text": "침묵한다", "next": "b_name_silence"}]
},

b_name_silence: {
  label: "B루트 — 침묵",
  text: `당신은 물끄러미 수첩을 내려다보며 침묵을 지켰다.
어째서인지 '진짜' 자신의 이름이 아닌 거짓 이름을 적는 것에 작은 저항감이 든다.
오른손에 쥔 펜에서 희미하게 잉크의 검은 냄새가 난다.
당신은 어쩐지 그 검은 냄새가 비냄새와 조금 닮았다고 생각한다.

쉬나벨은 당신이 이름을 적기를 한참을 기다렸다.
기다림이 길어지면 길어질 수록, 일렁이는 불꽃은 더욱 격렬히 연소하여 혼란스러운 당신의 마음을 대변하듯, 벽의 그림자를 크게 흔든다.

쉬나벨 : 그래, 어떤 이름을 적어야 할 지, 이게 맞는 건지 고민될 수도 있지. 그럼에도 불구하고, 살아가야 하지 않겠나? 여기까지 어떻게 굴러왔는데 말이야.

보리스는 낮게 깔리는 음울한 한숨소리와 함께 지친 목소리로 말한다.

보리스 : 이럴 여유가 길진 않을걸세. 어찌되었건 더 오래 살기 위해서는 여기에만 처박혀있을 수는 없을테니 말이야. 
하다못해 우리와 뜻을 함께 한다 하더라도, 이름 정도는 있어야 하지 않겠나. 또, 도시로 가게 될 텐데 그 때에도 이렇게 기다려 줄 사람들은 많지 않을거야.

쉬나벨 : 그래, 어쨌든 하나의 이름을 가진 존재로는 있어야 한다네. 정 어렵다면 우리가 정해줄 수도 있는데. 괜찮겠나? 

보리스 : 오래 생각 할 것도 없지. 자네는 "무명" 라고 부르겠네. 어떤가.`,
  choices: [{"text": "이름을 적는다", "next": "b_after_name", "effects": [{"op": "promptName"}]}, {"text": "끝까지 침묵한다 (무명)", "next": "b_after_name", "effects": [{"op": "setName", "name": "무명"}]}]
},

b_after_name: {
  label: "B루트 — 의뢰",
  text: `당신은 수첩에 이름을 적고 나니, 희미하게 몸에 온기가 도는 기분이 들었다. 
망망대해에서 표류하던 뗏목이 겨우 닻을 내리고 주위를 잠시 둘러볼 여유가 생긴 느낌이었다.

아주 약간의 안도를 느끼는 것도 잠시, 보리스가 사뭇 진지한 표정으로 자세를 고쳐 앉고 당신을 바라본다.

보리스 : 자네에게 부탁할 것이 하나 있네. 아아- 물론 맨입으로는 아니지. 

쉬나벨 : 그렇다고 부상중인 (playername), 자네에게 그렇게까지 어려운 일도 아니야. 우선은 좀 자기가 처한 상황을 한 번 둘러 볼 수 있는 기회도 겸사겸사 주는거라고나 할까! 

그렇게 말한 보리스는 두터운 재킷의 품을 뒤적거리고, 담배갑 만한 장치를 꺼내 당신에게 내밀었다.`,
  choices: [{"text": "보리스의 말을 듣는다", "next": "b_request"}]
},

b_request: {
  label: "B루트 — MAM과 편지",
  text: `보리스 : MAM. 기억보존장치라네. Memory Authentication Module의 줄임말이지. 자네가 쓰던건 더이상 작동하는 물건이라고 보긴 어려우니 말이야. 이건 의뢰 선금으로 지급하는거야. 이게 있어야 도시 내에서 자네를 의심하지도 않을테고 말이야. 이건 1단계, 사람이 사는데 있어서 가장 필요한 기초적인 것을 기억하게 지켜주는 물건일세. 언어, 상식은 물론이고 숨쉬는 법과 눈 깜빡이는 법도 포함이지. 

쉬나벨 : 물론 재수없게 [루스트라 교단]의 교리도 포함되어있고 말이야! 낙원은 무지한 어린아이와 같은 자들에게 있나니..! 기억은 과욕이요, 망각은 축복이라! 

쉬나벨은 키득거리며 교단의 유명한 교리 몇 가지를 장난스럽게 읊어대고는, 토하는 시늉을 한다. 

보리스 : 그래.. 그 빌어먹을 놈들의 교리가 포함되어있지. 아, 이미 지워져 버린 기억이 되돌아오는 장치는 아니라네. 
자네의 상식이 불완전한것도 아마 기존에 가지고 있던 MAM이 파손되어서 일거야. 어쨌든 이게 있으면 빗속에서 숨쉬는 걸 까먹은 채로 멍청하게 질식사 할 일은 없다는 얘기지. 

당신은 기억보존장치를 향해 손을 뻗다가 멈칫한다. 
그리고 보리스에게 의뢰란 어떤 것인지 묻는다.

보리스 : 그래, 그거야. 뭐든 의심부터 해보는 건 좋은 선택이지. 

쉬나벨 : 핫하! 생각이라는 것을 시작할 수 있게 되었군? 시작이 좋네. 보리스. 
이 친구야 말로 자네의 심부름에 딱 적합한 인재야!

보리스 : 그래, 그럴지도 모르겠군. 자, 그럼 설명하지...

보리스의 의뢰는 도시의 어느 주소에 있는 집에 가서 편지를 전해주라는 것이었다. 
어머니와 딸이 함께 살고 있는 집. 

보리스 : 다시 한 번 말하지만, 도착할 때 까지는 그 편지를 열어서는 안되네. 그냥 딱 전해주고 대답만 듣고 돌아오게. 내게 그 대답을 전해주면 의뢰가 완료된다네. 기간은.. 그래, 오늘 저 빌어먹을 비가 내렸으니, 앞으로 삼일 후에 다시 올거야. 그러니 이틀 안으로 내게 돌아와주면 되네. 여기서 먼 곳은 아니니 금방 돌아올 수 있을거야. 그리고, 만약 도망간다면...

쉬나벨 : 어이, 보리스! 이 친구가 우리한테 치료받은 은혜도 모르는 그런 매정한 녀석이라고 생각하는 건 아니겠지? 응?

쉬나벨이 중간에 보리스의 말을 자르자, 보리스는 한숨을 쉬었다. 

보리스 : 그래, 그래. 그럴거라고 생각하진 않는다네, 쉬나벨. 
어쨌든 이 의뢰는 받는 게 자네한테도 좋을거야. 이 MAM이 필요할테니 말이야.`,
  choices: [{"text": "의뢰를 받아들인다", "next": "b_accept"}]
},

b_accept: {
  label: "B루트 — 출발 전날",
  text: `당신은 보리스의 의뢰를 받아들이겠다고 마음먹었다.
동의의 표시로, 보리스가 내민 기억보존장치를 집어든다. 

-item MAM 획득-
-item 봉인된 편지 획득-

보리스 : 출발은 내일 아침이니, 우선 오늘은 마저 쉬어두게.

그 말을 끝으로 보리스는 당신의 수첩에 도착해야 할 주소를 적어주고, 편지를 사이에 끼워두고는 자리를 떠났다.
쉬나벨은 보리스에게 손을 흔들어 인사하고는, 당신에게 몸을 숙여 귓속말을 했다.

쉬나벨 : 사실 이 의뢰는 자네에게도 좋은 일이지만, 보리스에게도 아주 중요한 일이거든! 우린 도시에 얼굴이 많이 팔려서 들어가기가 어려워. 보리스가 말은 더 안했어도 자네에게 고마워하고 있을거야. 이 일을 맡길 사람이 없어서 걱정하고 있었네. 물론 나도, 감사를 표하지! 

쉬나벨은 한 쪽 눈을 찡긋 감아 당신에게 무언의 신뢰를 건넸다. 

쉬나벨 : 우선은 한숨 푹 자고 일어나라구, (playername)!

당신은 푹 쉬었다.
-체력 +1`,
  onEnter: [{"op": "addItem", "code": "item03"}, {"op": "addItem", "code": "item04"}, {"op": "flag", "key": "hasFunctionalMAM", "val": true}, {"op": "hp", "delta": 1}],
  choices: [{"text": "다음 날, 길을 떠난다", "next": "b_depart"}]
},

b_depart: {
  label: "B루트 — 길을 떠나다",
  text: `또 하나의 밤이 지나가고, 또 하나의 아침이 찾아왔다.
당신은 어두운 카타콤의 방에서 깨어나며 램프의 불꽃이 약해진 것을 깨달았다.

방을 나서자 보리스와 쉬나벨이 당신에게 다가왔다. 

보리스 : 여기서 쭉 외길을 따라 걸어나가면 자네가 쓰러져있던 그 장소에 도착하게 되네. 그곳에서 다시 거슬러 올라가면 도시의 외곽에 도착할 수 있을거야. 나름대로 구획정리가 잘 되어있으니, 주소를 찾는 것도 어렵지는 않을걸세. 다만 도시가 꽤 크니, 반나절 정도는 걸어야 할 수도 있네. 

쉬나벨 : 자, 모험을 떠나는 여행자에게 선물이 있지! 헤헤, 가면서 배가 고프면 먹도록 해! 아마 하루종일 먹어야 할거야!

쉬나벨은 당신에게 종이로 싼 커다란 보존식 하나를 건넨다. 
쉬나벨의 말대로 잘 배분해서 먹으면 하루치 식량이 될 수 있을 정도의 크기이다.

당신은 두 사람에게 고개숙여 인사를 건넨 뒤, 
되도록 빠르게 답변을 받아 돌아오도록 하겠노라고 말하고 뒤로 돌아 전진했다. 
이 곳으로 돌아오기까지, 앞으로 이틀이 남았다는 기억을 되새기며, 어딘가에 당신의 파편이 흩어져있을지도 모르는 도시를 향해 나아갔다.`,
  choices: [{"text": "도시로 향한다", "next": "stay_here"}]
},

bad_suffocation: {
  label: "배드엔딩 — 질식",
  text: `당신은 모든 기억을 잃었다.
생각하는 법도, 걷는 법도, 살아가는 것도, 존재하는 것도.
숨을 쉬는 것조차.

당신은 질식으로 사망했다.
이 답답한 세상에 절망하여 질식한 것이 아닌,
정말로 숨 쉬는 법을 잊어서.

하지만 이 도시에선 부끄러운 일이 아니다.
매년 수많은 사람들이 대책 없이 세정 강우를 맞아
호흡법을 잊고 사망한다.

부끄러운 일도 아니지만, 특별한 죽음도 아니라는 뜻이다.
당신의 몸은 한 줌 온기조차 보존하지 못한 채,
싸늘히 식어 빗물에 잠겨들었다.`,
  choices: [{"text": "처음부터 다시", "next": "prologue", "effects": [{"op": "hardReset"}]}]
},

a_wander1: {
      label: "A루트 · 방황 1/3",
      text: `재심사장 밖으로 나오자, 비는 여전히 모든 것을 두드리고 있었다.
하지만 당신의 목에는 ‘작동하는’ MAM이 매달려 있다.
그리고 손에는 젖은 수첩 한 권.

거리엔 친절한 안내문이 많았다.
친절한 문장들. 친절한 화살표들. 친절한 경고들.

그러나 그 친절은, 어쩐지 당신을 위한 것이 아니다.

[거리 포스터]
"성직자의 정화는 시민의 구원이다.
먼저 씻긴 자만, 인도할 수 있다."

하단의 작은 글씨.
"기억보존장치는 1층에서 무료로 지급받으실 수 있습니다."

무료.
당신은 그 단어가 이상하게 차갑다고 느낀다.`,
      choices: [
        { text: "포스터를 지나쳐 걷는다.", next: "a_wander2", meta: "발끝에서 물이 튄다." },
        { text: "포스터를 찢어본다. (아무 일도 일어나지 않는다)", next: "a_wander2", meta: "비가 손가락을 붙잡는다." }
      ]
    },

a_wander2: {
      label: "A루트 · 방황 2/3",
      text: `골목을 돌자, 얕은 차양 아래 사람들이 줄을 서 있었다.
누군가가 작은 종이컵을 나눠주고 있다.

종이컵엔 따뜻한 무언가가 담겨 있다.
냄새만으로도 ‘살아야 한다’는 감각이 올라온다.

하지만 줄의 끝에는, 또 하나의 테이블이 있다.
동의서. 서명란. 봉납. 기여.

당신은 방금, 비슷한 종이를 읽었다.
‘권리’라는 말을 들었고, ‘의무’라는 글자를 봤다.

누군가 당신을 보고 말한다.

"형제님, 여기로."

그 호칭이, 당신의 등골을 간질인다.`,
      choices: [
        { text: "고개를 숙이고 지나간다.", next: "a_wander3", meta: "모르는 척이 가장 안전하다." },
        { text: "잠시 멈춰 서류를 훑는다.", next: "a_wander3", meta: "글자들이 물처럼 번진다." }
      ]
    },

a_wander3: {
      label: "A루트 · 방황 3/3",
      text: `도시의 길은 이상하리만치 ‘정돈’되어 있다.
정돈되어 있다는 것은, 누군가 정리했다는 뜻이다.

교차로에서 드론 한 대가 호버링하며 안내 방송을 반복한다.

드론 : 정화일 규범을 준수해 주십시오.
정화일 규범을 준수해 주십시오.
정화일 규범을 준수해 주십시오.

반복은 주문이 된다.
주문은 생각을 잠식한다.

당신은 자신의 손에 있는 수첩을 내려다본다.
젖은 종이가, 젖은 피부처럼 느껴진다.

그리고, 눈을 들자…
어딘가 익숙한 하얀 사제복이 보인다.

그 ‘온화한 미소’가.`,
      choices: [
        { text: "사제에게 다가간다.", next: "a_priest_again" },
        { text: "발걸음을 돌린다.", next: "a_priest_again", meta:"하지만, 같은 곳으로 돌아온다." }
      ]
    },

a_priest_again: {
      label: "A루트 · 재회",
      text: `당신은 재심사장 앞—혹은 그 근처—에서, 다시 그 사제를 마주친다.
그가 당신을 알아보는지, 알아보지 못하는지…
당신은 판단할 기준이 없다.

사제는 당신의 젖은 수첩을 한 번,
목에 걸린 MAM을 한 번,
그리고 당신의 눈을 한 번 바라본다.

사제 : …다시 오셨군요.

그 말은 사실, 아무 의미도 없을 수 있다.
그럼에도 불구하고—
당신은 그 한 문장에 매달리고 싶어진다.

사제 : 정화일은 또 옵니다.
그리고 사람들은, 대비하지 못한 채로 매번 잃지요.

사제 : 형제님.
당신은 ‘살아남는 법’을 배워야 합니다.

사제는 얇은 봉투 하나를 내민다.
봉투엔 ‘소개장’이라는 단어가 적혀 있다.

사제 : 신학교로 가세요.
…원하신다면요.`,
      choices: [
        { text: "소개장을 받는다. (신학교로)", effects: [{op:"addItem", code:"item05"}], next: "a_seminary_stub" },
        { text: "거절하고, 다시 방황한다. (미구현)", next: "a_refuse_stub" }
      ]
    },

a_seminary_stub: {
      label: "A루트 · 신학교(미구현)",
      text: `봉투를 쥔 손에, 이상한 무게가 생긴다.
가벼운 종이일 뿐인데, 마치 ‘통로’를 들고 있는 기분이다.

[다음 장면: 신학교 진입(미구현)]`,
      choices: [
        { text: "처음으로 돌아간다.", next: "prologue", effects: [{op:"hardReset"}], meta:"(테스트/재시작)" }
      ]
    },

a_refuse_stub: {
      label: "A루트 · 방황 지속(미구현)",
      text: `당신은 봉투를 받지 않는다.
받는 순간, 당신이 무언가 ‘정해질’ 것 같아서.

사제는 미소를 거두지 않는다.

사제 : …그렇군요.
그럼, 다음에 다시 오세요.

[다음 장면: A루트 방황 확장(미구현)]`,
      choices: [
        { text: "처음으로 돌아간다.", next: "prologue", effects: [{op:"hardReset"}], meta:"(테스트/재시작)" }
      ]
    },

purification_stub: {
      label: "정화일(미구현)",
      text: `D-0.
정화일이 왔다.

하지만 오늘만큼은— 당신의 목에 있는 MAM이, 최소한의 ‘당신’을 붙잡고 있다.

[정화일 이벤트는 아직 구현되지 않았습니다.]
(임시로 D-3으로 되돌립니다.)`,
      choices: [
        { text: "계속", next: "stay_here" }
      ]
    },

stay_here: {
      label: "계속(임시)",
      text: `당신은 숨을 쉰다.
아직은. 아직은.`,
      choices: [
        { text: "처음으로 돌아간다.", next: "prologue", effects: [{op:"hardReset"}] }
      ]
    }
};

  // -----------------------------
  // Effects
  // -----------------------------
  function applyEffects(effects){
    if (!effects || !effects.length) return;
    for (const ef of effects){
      switch(ef.op){
        case "hp": {
          const before = state.hp;
          state.hp = clamp(state.hp + (ef.delta||0), 0, state.hpMax);
          const delta = state.hp - before;
          if (delta !== 0) addLog(`체력 ${delta>0?"+":""}${delta} → ${state.hp}/${state.hpMax}`);
          break;
        }
        case "addItem":
          addItem(ef.code);
          break;
        case "setMAM":
          setFunctionalMAM(ef.on);
          addLog(`기능성 MAM: ${ef.on ? "획득" : "상실"}`);
          break;
        case "promptName": {
          const cur = state.playerName || "";
          const input = prompt("이름을 입력하세요 (빈칸이면 취소)", cur);
          if (input && input.trim().length){
            state.playerName = input.trim();
            addLog(`이름 설정: ${state.playerName}`);
          } else {
            addLog("이름 입력을 건너뜀");
          }
          break;
        }
        case "setName": {
          const nm = (ef.name||"").trim();
          if (nm.length){
            state.playerName = nm;
            addLog(`이름 설정: ${state.playerName}`);
          }
          break;
        }
        case "flag":
          state.flags[ef.key] = ef.val;
          addLog(`플래그: ${ef.key} = ${ef.val}`);
          break;
        case "hardReset":
          state = DEFAULT_STATE();
          localStorage.removeItem(STORAGE_KEY);
          break;
      }
    }
  }

  function runOnEnter(scene){
    if (!scene || !scene.onEnter) return;
    applyEffects(scene.onEnter);
  }

  // -----------------------------
  // Rendering
  // -----------------------------
  function renderStats(){
    el("statDay").textContent = state.day;
    el("statD").textContent = `D-${Math.max(0, state.daysUntilPurification)}`;
    el("statHP").textContent = state.hp;
    el("statHPMax").textContent = state.hpMax;
    el("statMAM").textContent = state.flags.hasFunctionalMAM ? "있음" : "없음";
    el("statMAM").className = state.flags.hasFunctionalMAM ? "good" : "bad";
  }

  function escapeHtml(s){
    return (s||"").replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function renderScene(){
    const scene = SCENES[state.sceneId];
    el("sceneId").textContent = `scene: ${state.sceneId}`;
    el("sceneLabel").textContent = `· ${(scene && scene.label) ? scene.label : ""}`;

    el("sceneText").textContent = scene ? substitute(scene.text) : "(알 수 없는 장면)";

    const choicesEl = el("choices");
    choicesEl.innerHTML = "";
    const choices = (scene && scene.choices) ? scene.choices : [];
    for (const ch of choices){
      const btn = document.createElement("button");
      btn.className = "choice-btn";
      btn.innerHTML = `${escapeHtml(substitute(ch.text))}${ch.meta ? `<span class="meta">${escapeHtml(substitute(ch.meta))}</span>` : ""}`;
      btn.onclick = () => {
        if (ch.effects) applyEffects(ch.effects);
        goto(ch.next);
      };
      choicesEl.appendChild(btn);
    }
  }

  function renderInventory(){
    const list = el("invList");
    list.innerHTML = "";
    const inv = state.inventory.slice().sort();
    el("invEmpty").style.display = inv.length ? "none" : "block";
    for (const code of inv){
      const it = ITEM_DB[code];
      if (!it) continue;
      const row = document.createElement("div");
      row.className = "inv-item";
      row.innerHTML = `
        <div class="left">
          <div class="code mono">${it.code}</div>
          <div class="name">${escapeHtml(it.name)}</div>
          <div class="type">${escapeHtml(it.type)}</div>
        </div>
        <div class="muted">보기</div>
      `;
      row.onclick = () => openModal(`${it.name} · ${it.code}`, it.desc);
      list.appendChild(row);
    }
  }

  function renderLog(){
    el("logBox").textContent = state.log.join("\n");
  }

  function openModal(title, body){
    el("modalTitle").textContent = title;
    el("modalBody").textContent = substitute(body);
    el("modal").classList.add("open");
  }

  function closeModal(){
    el("modal").classList.remove("open");
  }

  function setTab(tab){
    document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.tab === tab));
    el("tab-inventory").style.display = (tab==="inventory") ? "block" : "none";
    el("tab-log").style.display = (tab==="log") ? "block" : "none";
    el("tab-help").style.display = (tab==="help") ? "block" : "none";
  }

  // -----------------------------
  // Navigation
  // -----------------------------
  function goto(id){
    if (!SCENES[id]) { toast(`알 수 없는 장면: ${id}`); return; }
    state.sceneId = id;
    runOnEnter(SCENES[id]);
    renderAll();
  }

  // -----------------------------
  // Day / Rest / Purification
  // -----------------------------
  function rest(){
    state.day += 1;
    state.daysUntilPurification = Math.max(0, state.daysUntilPurification - 1);

    const before = state.hp;
    state.hp = clamp(state.hp + 1, 0, state.hpMax);
    if (state.hp !== before) addLog(`휴식: 체력 +${state.hp - before} → ${state.hp}/${state.hpMax}`);
    addLog(`하루 경과: D-${state.daysUntilPurification}`);

    if (state.daysUntilPurification <= 0){
      if (!state.flags.hasFunctionalMAM){
        goto("bad_suffocation");
        return;
      }
      state.daysUntilPurification = 3;
      addLog("정화일 통과(임시): D-3으로 재설정");
      goto("purification_stub");
      return;
    }
    renderAll();
  }

  // -----------------------------
  // Save / Load
  // -----------------------------
  function save(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      toast("저장 완료!");
    } catch(e){
      toast("저장 실패: 저장공간/권한을 확인해줘.");
    }
  }

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw){ toast("저장 데이터가 없어."); return; }
      const parsed = JSON.parse(raw);
      if (!parsed || typeof parsed !== "object"){ toast("저장 데이터가 손상됨"); return; }
      state = Object.assign(DEFAULT_STATE(), parsed);
      if (!Array.isArray(state.inventory)) state.inventory = [];
      if (!Array.isArray(state.log)) state.log = [];
      toast("불러오기 완료!");
      renderAll();
    } catch(e){
      toast("불러오기 실패: 데이터가 손상되었을 수 있어.");
    }
  }

  function newGame(){
    if (!confirm("정말 새로 시작할까? (저장도 초기화됨)")) return;
    state = DEFAULT_STATE();
    localStorage.removeItem(STORAGE_KEY);
    toast("새로 시작!");
    renderAll();
  }

  // -----------------------------
  // Render all
  // -----------------------------
  function renderAll(){
    if (state.hp <= 0 && state.sceneId !== "bad_suffocation"){
      goto("bad_suffocation");
      return;
    }
    renderStats();
    renderInventory();
    renderLog();
    renderScene();
  }

  // -----------------------------
  // Wire events
  // -----------------------------
  el("btnRest").addEventListener("click", rest);
  el("btnSave").addEventListener("click", save);
  el("btnLoad").addEventListener("click", load);
  el("btnNew").addEventListener("click", newGame);

  document.querySelectorAll(".tab").forEach(t => t.addEventListener("click", () => setTab(t.dataset.tab)));
  el("modalClose").addEventListener("click", closeModal);
  el("modal").addEventListener("click", (e)=>{ if (e.target === el("modal")) closeModal(); });

  // auto-load if exists
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw){
      const parsed = JSON.parse(raw);
      if (parsed && typeof parsed === "object"){
        state = Object.assign(DEFAULT_STATE(), parsed);
      }
    }
  } catch(e){}

  renderAll();
})();
</script>
</body>
</html>
